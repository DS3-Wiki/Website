<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Builds</title>
    <link rel="stylesheet" href="./css/builds.css">
    <link rel="shortcut icon" href="./Assets/img/pngwing.com.png" type="image/x-icon">
</head>
<body>
    <main>
        <nav class="navbar">
            <ul class="lista_navbar">
                <li>
                    <a href="./builds.html">
                        Builds
                    </a>
                </li>
                <li>
                    <a href="./chefes.html">
                        Chefes
                    </a>
                </li>
                <li class="home_button">
                    <a href="./index.html">
                        <img src="./Assets/img/maldicao.png">
                        Souls Builds
                    </a>
                </li>
                <li>
                    <a href="#Somos">
                        Sobre
                    </a>
                </li>
                <li>
                    <a href="#Footer">
                        Contato
                    </a>
                </li>
            </ul>
        </nav>
        <section class="section_1">
            <!-- Boss -->
            <div class="boss">
                CHEFE

                <!-- Filtrar o nome do chefe e trazer as informações dele direto do banco de dados -->
                <input id="input_boss_name">
                <datalist list="input_boss_name">
                    <!-- Vindo do Banco -->
                    <option value=""></option>
                </datalist>
                <img src="">
            </div>
              <!-- BUILDS -->
              <div class="build">

                <div class="stats">
                    <!-- VIGOR -->
                    <figure>  
                        <img src="./Assets/img/stats/Vigor_Icon.webp">
                        <input onkeyup="atualizar_grafico()"  id="atributo_Vigor">
                    </figure>

                    <!-- ATTUNEMENT  -->
                    <figure>
                        <img src="./Assets/img/stats/Attunement_Icon.webp">
                        <input onkeyup="atualizar_grafico()"  id="atributo_Attunement">
                    </figure>

                    <!-- ENDURENCE -->
                    <figure>
                        <img src="./Assets/img/stats/Endurance_Icon.webp">    
                        <input onkeyup="atualizar_grafico()"  id="atributo_Endurence">
                    </figure>

                    <!-- VITALITY  -->
                    <figure>
                        <img src="./Assets/img/stats/Vitality_Icon.webp">
                        <input onkeyup="atualizar_grafico()"  id="atributo_Vitality">
                    </figure>

                    <!-- STRENGTH  -->
                    <figure>
                        <img src="./Assets/img/stats/Strength_Icon.webp">
                        <input onkeyup="atualizar_grafico()"  id="atributo_Strength">
                    </figure>

                    <!-- DEXTERITY  -->
                    <figure>
                        <img src="./Assets/img/stats/Dexterity_Icon.webp">
                        <input onkeyup="atualizar_grafico()"  id="atributo_Dexterity">
                    </figure>

                    <!-- INTELLIGENCE  -->
                    <figure>
                        <img src="./Assets/img/stats/Intelligence_Icon.webp">
                        <input onkeyup="atualizar_grafico()"  id="atributo_Intelligence">
                    </figure>

                    <!-- FAITH  -->
                    <figure>
                        <img src="./Assets/img/stats/Faith_Icon.webp">
                        <input onkeyup="atualizar_grafico()"  id="atributo_Faith">
                    </figure>

                    <!-- LUCK  -->
                    <figure>
                        <img src="./Assets/img/stats/Luck_Icon.webp">
                        <input onkeyup="atualizar_grafico()"  id="atributo_Luck">
                    </figure>
                </div>

                <div class="stats_2">

                <div>
                    <h3>Builds Cadastradas:</h3>
                    <input>
                    <h3>Nível:</h3>
                    <div id="div_nivel_total">
                    </div>
                </div>   

                <div class="nome_button">
                    <input id="input_nome" placeholder="Nome">
                    <button onclick="cadastrar_classe()">Cadastrar</button>
                </div>

                 <!-- GRÁFICO DE JOGADOR DE FUTEBOL PARA A CLASSE  -->
                <div class="build_grafico">
                    <canvas id="myChart"></canvas>
                  </div>
                  
                  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                  
                  <script>
                    var myChart;

                    const ctx = document.getElementById('myChart');
                  
                    myChart = new Chart(ctx, {
                      type: 'polarArea',
                      data: {
                        labels: ['VGR', 'ATT', 'END', 'VIT', 'STR', 'DEX', 'INT', 'FTH', 'LCK'],
                        datasets: [{
                          label: 'Níveis',
                          data: [20, 12, 30, 60],
                          borderWidth: 1
                        }]
                      },
                      options: {
                        scales: {
                          y: {
                            beginAtZero: true
                          }
                        }
                      }
                    });
                    function atualizar_grafico() {
                        
                        var nivel_total = 
                            Number( atributo_Vigor.value)+ 
                            Number( atributo_Attunement.value)+
                            Number( atributo_Endurence.value)+
                            Number( atributo_Vitality.value)+
                            Number( atributo_Strength.value)+
                            Number( atributo_Dexterity.value)+
                            Number( atributo_Intelligence.value)+
                            Number( atributo_Faith.value)+
                            Number( atributo_Luck.value);
                        
                        div_nivel_total.innerHTML = nivel_total;
                        var statisticas = [
                        atributo_Vigor.value,
                        atributo_Attunement.value,
                        atributo_Endurence.value,
                        atributo_Vitality.value,
                        atributo_Strength.value,
                        atributo_Dexterity.value,
                        atributo_Intelligence.value,
                        atributo_Faith.value,
                        atributo_Luck.value 
                        
                        ];
                        myChart.data.datasets[0].data = statisticas;
                        myChart.update();
                    }                    
                  </script>
                </div>
                  
            </div>

                <!-- ANALYTICS -->
            <div class="analytics">
                Analytics
            </div>
        </section>   


        <!-- MODAL  -->

        <div class="modal" id="modal_background">
            <div class="modal_login_cadastro" id="modal">
                <!-- MODAL LOGIN -->
                <div class="login" id="login">
                    <p>Login</p>
                    <div class="email">
                        <p>Email</p>
                        <input id="input_login_email">
                    </div>
                    <div class="senha">
                        <p>Senha:</p>
                        <input type="password" id="input_login_password">
                    </div>
                    <div class="botao">
                        <button onclick="login()">Login</button>
                        <a onclick="modal_to_cadastro()">
                            <p>Ainda não possuo cadastro</p>
                        </a>
                    </div>
                </div>
                <!-- MODAL CADASTRO -->
                <div class="cadastro">
                    <p>Cadastro</p>
                    <div class="email">
                        <p>Nome</p>
                        <input id="input_cadastro_name">
                    </div>
                    <div class="email">
                        <p>Email</p>
                        <input id="input_cadastro_email">
                    </div>
                    <div class="email">
                        <p>Senha:</p>
                        <input type="password" id="input_cadastro_password">
                    </div>
                    <div class="ds_experience">
                        <p>Experiência em DS</p>
                    </div>
                    <div class="botao">
                        <button onclick="cadastrar()">Cadastrar</button>
                        <a onclick="modal_to_login()">
                            <p>Quero fazer o login</p>
                        </a>
                    </div>
                </div>
            </div>
        </div>

    </main>
</body>
</html>
<!-- CARROSEL -->
<script>
    var numero = 10;
    var classes = [];

    function cadastrar_classe() {
        var build = {
            nome: input_nome.value,
            atributos: {
                Vigor: atributo_Vigor.value,
                Attunement:  atributo_Attunement.value,
                Endurence: atributo_Endurence.value,
                Vitality: atributo_Vitality.value,
                Strength: atributo_Strength.value,
                Dexterity: atributo_Dexterity.value,
                Intelligence: atributo_Intelligence.value,
                Faith: atributo_Faith.value,
                Luck: atributo_Luck.value 
            }
        }

        classes.push(build) 
    }

</script>

         <!-- setTimeout(()=> {
                
                for(i=0; i > -397; i--) {
        
                    tela_login.style.marginLeft = `${i}px`;
            }
            }, 1000)
         -->

<!-- CADASTRO -->
<script>

    var tela_login = document.getElementById("login");
    var modal = document.getElementById("modal");
    var modal_background = document.getElementById("modal_background")

    function modal_to_login(){
        tela_login.style.marginLeft = "0px";
        modal.style.height = "510px";
    }

    function modal_to_cadastro() {
         tela_login.style.marginLeft = "-397px";
         modal.style.height = "660px";  
    }


    function login() {

        var emailVar = input_login_email.value;
        var passwordVar = input_login_password.value;

        if (emailVar == "" || passwordVar == "") {
            alert("Todos os campos precisam ser preenchidos")            
            return false;
        }
        else {
            setInterval(sumirMensagem, 5000)
        }

        console.log("FORM LOGIN: ", emailVar);
        console.log("FORM SENHA: ", passwordVar);

        fetch("/usuarios/login", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                emailServer: emailVar,
                passwordServer: passwordVar
            })
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO login()!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));

                    sessionStorage.EMAIL_USUARIO = json.email;
                    sessionStorage.NOME_USUARIO = json.nome;
                    sessionStorage.ID_USUARIO = json.id;

                    setTimeout(function () {
                        alert("Login realizado !!")
                        modal_background.style.display = "none";;
                    }, 1000); // apenas para exibir o loading

                });

            } else {

                console.log("Houve um erro ao tentar realizar o login!");

                resposta.text().then(texto => {
                    console.error(texto);
                    finalizarAguardar(texto);
                });
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;
    }

    function cadastrar() {

        //Recupere o valor da nova input pelo nome do id
        // Agora vá para o método fetch logo abaixo
        var nameVar = input_cadastro_name.value
        var emailVar = input_cadastro_email.value;
        var passwordVar = input_cadastro_password.value;

        if (nameVar == "" || emailVar == "" || passwordVar == "") {
            mensagem_erro.innerHTML = "(Todos os campos devem ser preenchidos)";

            return false;
        }
        else {
            setInterval(sumirMensagem, 5000)
        }

        // Enviando o valor da nova input
        fetch("/usuarios/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                nameServer: nameVar,
                emailServer: emailVar,
                passwordServer: passwordVar,
            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                alert("Cadastro realizado !!")
                modal_background.style.display = "none";
            
                limparFormulario();
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });

        return false;
    }
</script>

<!-- BOSSES -->
<script>
    function entrar() {
        aguardar();

        var emailVar = email_input.value;
        var senhaVar = senha_input.value;

        if (emailVar == "" || senhaVar == "") {
            mensagem_erro.innerHTML = "(Mensagem de erro para todos os campos em branco)";
            finalizarAguardar();
            return false;
        }
        else {
            alert("Erro ao efetuar o cadastro")
        }

        console.log("FORM LOGIN: ", emailVar);
        console.log("FORM SENHA: ", senhaVar);

        fetch("/usuarios/autenticar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                emailServer: emailVar,
                senhaServer: senhaVar
            })
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO entrar()!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));

                    sessionStorage.EMAIL_USUARIO = json.email;
                    sessionStorage.NOME_USUARIO = json.nome;
                    sessionStorage.ID_USUARIO = json.id;

                    setTimeout(function () {
                        window.location = "./dashboard/cards.html";
                    }, 1000); // apenas para exibir o loading

                });

            } else {

                console.log("Houve um erro ao tentar realizar o login!");

                resposta.text().then(texto => {
                    console.error(texto);
                    finalizarAguardar(texto);
                });
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;
    }

    function sumirMensagem() {
    }
</script>

<!-- BUILDS -->

<script>
    function entrar() {
        aguardar();

        var emailVar = email_input.value;
        var senhaVar = senha_input.value;

        if (emailVar == "" || senhaVar == "") {
            mensagem_erro.innerHTML = "(Mensagem de erro para todos os campos em branco)";
            finalizarAguardar();
            return false;
        }
        else {
            setInterval(sumirMensagem, 5000)
        }

        console.log("FORM LOGIN: ", emailVar);
        console.log("FORM SENHA: ", senhaVar);

        fetch("/usuarios/autenticar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                emailServer: emailVar,
                senhaServer: senhaVar
            })
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO entrar()!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));

                    sessionStorage.EMAIL_USUARIO = json.email;
                    sessionStorage.NOME_USUARIO = json.nome;
                    sessionStorage.ID_USUARIO = json.id;

                    setTimeout(function () {
                        window.location = "./dashboard/cards.html";
                    }, 1000); // apenas para exibir o loading

                });

            } else {

                console.log("Houve um erro ao tentar realizar o login!");

                resposta.text().then(texto => {
                    console.error(texto);
                    finalizarAguardar(texto);
                });
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;
    }

    function sumirMensagem() {
    }
</script>